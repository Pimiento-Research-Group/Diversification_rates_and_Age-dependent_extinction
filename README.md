# 145-million-year global reconstruction of neoselachian diversification reveals new extinction events and persistent age-dependency 

This repository contains the code and data for the analyses presented in the manuscript:

**"145-million-year global reconstruction of neoselachian diversification reveals new extinction events and persistent age-dependency"**  
**Kristína Kocáková<sup>1*</sup>, Daniele Silvestro<sup>2,3,4*</sup>, Gregor Mathes<sup>1,5</sup>, Jaime A. Villafaña<sup>6</sup>, Catalina Pimiento<sup>*1,7</sup>**  

<sup>1</sup>Department of Paleontology, University of Zurich, Zurich, 8006, Switzerland<br />
<sup>2</sup>Department of Biology, University of Fribourg, Fribourg, 1700, Switzerland<br />
<sup>3</sup>Swiss Institute of Bioinformatics, Fribourg, 1700, Switzerland<br />
<sup>4</sup>Department of Biological and Environmental Sciences, Global Gothenburg Biodiversity Centre, University of Gothenburg, Gothenburg, 413 19, Sweden<br />
<sup>5</sup>GeoZentrum Nordbayern, Friedrich-Alexander University Erlangen-Nürnberg (FAU), Erlangen, 91054, Germany<br />
<sup>6</sup>Departamento de Ecología, Facultad de Ciencias, Universidad Católica de la Santísima Concepción, Concepción, 4090541, Chile<br />
<sup>7</sup>Department of Biosciences, Swansea University, Swansea, SA2 8PP, UK<br />

\*Corresponding authors: [kristina.kocakova@pim.uzh.ch](mailto:kristina.kocakova@pim.uzh.ch); [daniele.silvestro@unifr.ch](mailto:daniele.silvestro@unifr.ch); [catalina.pimientohernandez@pim.uzh.ch](mailto:catalina.pimientohernandez@pim.uzh.ch)

---

## Overview

This repository contains the scripts used to estimate rates of extinction and speciation, and evaluate age-dependent extinction (ADE) of neoselachian species and genera through the last 145 Myr.

### Repository Structure

- **`data/`**  
  Contains:
  - a .txt file with geological stage boundaries in milions of years (Myr)
  - PyRate input files generated and used in the analyses presented in the publication
  - four pre-trained models used for the estimation of ADE

- **`code/`**  
  Contains:
  - the scripts for the analyses
  - requirements.txt file with the required Python packages

---

## Usage notes

The PyRate program is required for a portion of the analyses in this study, the program and the instruction on how to compile it can be found in [this repository](https://github.com/dsilvestro/PyRate).

1. **PyRate input step 1.** 
  - filters the FINS dataset to produce a .txt file usable by the PyRate program, for an example of a PyRate input file see [this repository](https://github.com/dsilvestro/PyRate/wiki/1.-Preparing-input-file)
  - *input* - Occurrences data from the FINS Dataset openly accessible [here](https://zenodo.org/uploads/13983668)
  - *output* - .txt file formatted according to PyRate requirements
  - *alternative output* - if adenn = True argument is used, this script generates a .txt input file needed for the ADE-NN analyses
2. **PyRate input file step 1.**
  - converts the .txt file generated in Script 1. to a *_PyRate.py file readable by the PyRate program
  - the function in this script assigns an age to each occurrence randomy sampled from a uniform distribution delimited by the minimum and maximum age of the occurrence, for details see [this repository](https://github.com/dsilvestro/PyRate/wiki/1.-Preparing-input-file)
  - in our analyses we created an input file with 10 replicates of sampled ages
  - *input* - .txt file generated by Script 1.
  - *output* - *_PyRate.py file and a *_TaxonList.txt file containing a list of all unique taxa in the input file with the respective extinct/extant status. The taxon list file is not used in any further analyses here, but can be useful for data exploration. 
  - *Note*: As the process of the *_PyRate.py file creation has an element of stochasticity, we provide the files generated and used in subsequent analyses of this study in the [/data folder](https://github.com/Pimiento-Research-Group/Diversification_rates_and_Age-dependent_extinction/tree/master/data) in this repository, for the purpose of reproducibility
3. **PyRate Analyses**<br />
3.1. **Rate calculation**
    - estimates extinction, speciation and net diversification rates
    - the script is provided in a form of a shell script which can be submitted to a HPC Cluster, however it can also be ran locally by only running the final line of the script without the `srun` command and providing a replicate number for the `-j` argument
    - we used the following settings:
        - `-n` 50000000 - number of generations
        - `-s` 1000 - sample every 1000th generation
        - `-qShift` - allow peservation rate to vary in each geological stage (requires a .txt file, see *input* below)
        - `-min_dt` 0.5 - look for a rate shift every 0.5 Myr
        - - `-mG`- allow preservation rate to vary amongst taxa
        - `-pP` 2 0 - prior for the gamma distribution of preservation rates
        - `-fast_burnin` 25000 -
        - `-fQ` 0.05 -
        - `-fU` 0.05 0.2 0 - 
        - `-singleton` 1 - excludes singletons, used in the main analysis and omitted in supplementary analysis
        - an overview of other PyRate settings can be accessed [here](https://github.com/dsilvestro/PyRate/wiki/2.-PyRate:-command-list#main-analysis-settings)
    - *input* - *_PyRate.py file generated in Step 2. and a .txt file containing starting and ending points of geological stages in Myr, which is provided [here](https://github.com/Pimiento-Research-Group/Diversification_rates_and_Age-dependent_extinction/tree/master/data) as ages.txt
    - *output* - 


















